!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Immerser=t():e.Immerser=t()}(this,(function(){return(()=>{"use strict";var e={98:e=>{function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function r(e){return null!==e&&"object"==typeof e&&!1===Array.isArray(e)}function o(e){var r=e.optionConfig,o=e.userOptions,i=void 0===o?{}:o,n=e.preffix,s=void 0===n?"":n,a=e.suffix,l=void 0===a?"":a,c=e.strict,d=void 0===c||c,u=function(e){return[s,e,l].join(" ")},h={};for(var f in r)if(t(r,f)){var p=r[f],y=p.required,v=p.default,m=p.description,g=p.validator,b=i[f],k=!!t(p,"required")&&("function"==typeof y?y(i):y),A=t(i,f),w=g(b,i);if(k){if(!A)throw new TypeError(u(f+" is required."));if(!w)throw new TypeError(u("Expected "+f+" to be "+m+", got "+typeof b+" "+b+"."));h[f]=b}else if(h[f]=v,A)if(w)h[f]=b;else{if(d)throw new TypeError(u("Expected "+f+" to be "+m+", got "+typeof b+" "+b+"."));console.warn(u("Expected "+f+" to be "+m+", got "+typeof b+" "+b+". Fallback to default value "+v+"."))}}return h}var i="[mergeOptions]:",n="\nCheck out documentation https://github.com/dubaua/merge-options#parameters-and-return";function s(e){throw new TypeError([i,e,n].join(" "))}var a={optionConfig:{required:!0,validator:function(e){for(var o in e)if(t(e,o)){var i=e[o];if(r(i)||s("Expected optionConfig."+o+" to be an object with declarative option configuration, got "+typeof i+" "+i+"."),t(i,"required")){var n=i.required,a=typeof n;"boolean"!==a&&"function"!==a&&s("Expected optionConfig."+o+".required to be either boolean or function, got "+typeof n+" "+n+".")}else t(i,"default")||s("Expected optionConfig."+o+" to either have required or default value.");if(t(i,"default")||t(i,"required")||s("Expected optionConfig."+o+" to either have required or default value."),t(i,"description")){var l=i.description;"string"!=typeof i.description&&s("Expected optionConfig."+o+".description to be a string, got "+typeof l+" "+l+".")}else s("Missing description on optionConfig."+o+" config.");if(t(i,"validator")){var c=i.validator;"function"!=typeof i.validator&&s("Expected optionConfig."+o+".validator to be a function, got "+typeof c+" "+c+".")}else s("Missing validator on optionConfig."+o+" config.")}return r(e)},description:"an object with declarative option configuration"},userOptions:{required:!1,default:{},validator:r,description:"an object"},preffix:{required:!1,default:"",validator:function(e){return"string"==typeof e},description:"a string"},suffix:{required:!1,default:"",validator:function(e){return"string"==typeof e},description:"a string"},strict:{required:!1,default:!0,validator:function(e){return"boolean"==typeof e},description:"a boolean"}};e.exports=function(e){var t=o({optionConfig:a,userOptions:e,preffix:i,suffix:n});return o(t)}},971:e=>{e.exports=function(){function e(e){this.callbacks=[],this.internal=e}var t;return e.prototype.subscribe=function(e){var t=this;if("function"!=typeof e)throw new TypeError("[createObservable]: expected callback to be a function.");return this.callbacks.push(e),function(){var r=t.callbacks.indexOf(e);t.callbacks=t.callbacks.slice(0,r).concat(t.callbacks.slice(r+1))}},(t=[{key:"value",get:function(){return this.internal},set:function(e){if(e!==this.internal){var t=this.internal;this.internal=e;for(var r=0;r<this.callbacks.length;r++)this.callbacks[r](this.internal,t)}}}])&&function(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}(e.prototype,t),e}()},254:(e,t,r)=>{r.d(t,{default:()=>Immerser});var o=r(98),i=r.n(o),n=r(971),s=r.n(n),a=/^[a-z_-][a-z\d_-]*$/i;var l={solidClassnameArray:{default:[],description:"non empty array of objects",validator:function(e){return Array.isArray(e)&&0!==e.length}},fromViewportWidth:{default:0,description:"a natural number",validator:function(e){return"number"==typeof e&&0<=e&&e%1==0}},pagerThreshold:{default:.5,description:"a number between 0 and 1",validator:function(e){return"number"==typeof e&&0<=e&&e<=1}},hasToUpdateHash:{default:!1,description:"a boolean",validator:function(e){return"boolean"==typeof e}},scrollAdjustThreshold:{default:0,description:"a number greater than or equal to 0",validator:function(e){return"number"==typeof e&&e>=0}},scrollAdjustDelay:{default:600,description:"a number greater than or equal to 300",validator:function(e){return"number"==typeof e&&e>=300}},pagerLinkActiveClassname:{default:"pager-link-active",description:"valid non empty classname string",validator:function(e){return"string"==typeof e&&""!==e&&a.test(e)}},isScrollHandled:{default:!0,description:"a boolean",validator:function(e){return"boolean"==typeof e}},onInit:{default:null,description:"a function",validator:function(e){return"function"==typeof e}},onBind:{default:null,description:"a function",validator:function(e){return"function"==typeof e}},onUnbind:{default:null,description:"a function",validator:function(e){return"function"==typeof e}},onDestroy:{default:null,description:"a function",validator:function(e){return"function"==typeof e}},onActiveLayerChange:{default:null,description:"a function",validator:function(e){return"function"==typeof e}}},c="[immmerser:]";function d(e,t){for(var r in t)e.style[r]=t[r]}function u(e){var t=e.selector,r=e.parent,o=void 0===r?document:r;if(!o)return[];var i=o.querySelectorAll(t);return[].slice.call(i)}function h(e){var t=e.message,r=e.warning,o=void 0!==r&&r,i=e.docs,n=i||"",s="".concat(c," ").concat(t," \nCheck out documentation https://github.com/dubaua/immerser").concat(n);if(!o)throw new Error(s);console.warn(s)}function f(e,t,r){return Math.max(Math.min(e,r),t)}function p(){var e=window.scrollX||document.documentElement.scrollLeft,t=window.scrollY||document.documentElement.scrollTop;return{x:f(e,0,document.documentElement.offsetWidth),y:f(t,0,document.documentElement.offsetHeight)}}function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function v(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){g(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function m(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function g(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var b={position:"absolute",top:0,right:0,bottom:0,left:0,overflow:"hidden"},k={pointerEvents:"none",touchAction:"none"},A={pointerEvents:"all",touchAction:"auto"},Immerser=function(){function Immerser(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Immerser),g(this,"options",{}),g(this,"selectors",{root:"[data-immerser]",layer:"[data-immerser-layer]",solid:"[data-immerser-solid]",pagerLink:"[data-immerser-pager-link]",mask:"[data-immerser-mask]",maskInner:"[data-immerser-mask-inner]",synchroHover:"[data-immerser-synchro-hover]"}),g(this,"stateArray",[]),g(this,"stateIndexById",{}),g(this,"isBound",!1),g(this,"rootNode",null),g(this,"layerNodeArray",[]),g(this,"solidNodeArray",[]),g(this,"pagerLinkNodeArray",[]),g(this,"originalSolidNodeArray",[]),g(this,"maskNodeArray",[]),g(this,"synchroHoverNodeArray",[]),g(this,"isCustomMarkup",!1),g(this,"customMaskNodeArray",[]),g(this,"documentHeight",0),g(this,"windowHeight",0),g(this,"immerserTop",0),g(this,"immerserHeight",0),g(this,"resizeFrameId",null),g(this,"scrollFrameId",null),g(this,"scrollAdjustTimerId",null),g(this,"reactiveActiveLayer",new(s())),g(this,"reactiveWindowWidth",new(s())),g(this,"reactiveSynchroHoverId",new(s())),g(this,"stopRedrawingPager",null),g(this,"stopUpdatingHash",null),g(this,"stopFiringActiveLayerChangeCallback",null),g(this,"stopTrackingSynchroHover",null),g(this,"stopToggleBindOnRezise",null),g(this,"onResize",null),g(this,"onScroll",null),g(this,"onSynchroHoverMouseOver",null),g(this,"onSynchroHoverMouseOut",null),this.init(e)}var e,t,r;return e=Immerser,(t=[{key:"init",value:function(e){this.setNodes(),this.validateMarkup(),this.mergeOptions(e),this.getClassnamesFromMarkup(),this.validateSolidClassnameArray(),this.initSectionIds(),this.initStatemap(),this.validateClassnames(),this.toggleBindOnRezise(),this.setSizes(),this.addScrollAndResizeListeners(),"function"==typeof this.options.onInit&&this.options.onInit(this)}},{key:"setNodes",value:function(){this.rootNode=document.querySelector(this.selectors.root),this.layerNodeArray=u({selector:this.selectors.layer}),this.solidNodeArray=u({selector:this.selectors.solid,parent:this.rootNode})}},{key:"validateMarkup",value:function(){this.rootNode||h({message:"immerser root node not found.",docs:"#prepare-your-markup"}),this.layerNodeArray.length<0&&h({message:"immerser will not work without layer nodes.",docs:"#prepare-your-markup"}),this.solidNodeArray.length<0&&h({message:"immerser will not work without solid nodes.",docs:"#prepare-your-markup"})}},{key:"mergeOptions",value:function(e){this.options=i()({optionConfig:l,userOptions:e,preffix:c,suffix:"\nCheck out documentation https://github.com/dubaua/immerser#options"})}},{key:"getClassnamesFromMarkup",value:function(){var e=this;this.layerNodeArray.forEach((function(t,r){if(t.dataset.immerserLayerConfig)try{e.options.solidClassnameArray[r]=JSON.parse(t.dataset.immerserLayerConfig)}catch(e){console.error(c,"Failed to parse JSON classname configuration.",e)}}))}},{key:"validateSolidClassnameArray",value:function(){var e=this.layerNodeArray.length;this.options.solidClassnameArray.length!==e&&h({message:"solidClassnameArray length differs from count of layers",docs:"#options"})}},{key:"initSectionIds",value:function(){var e=this;this.layerNodeArray.forEach((function(t,r){var o=t.id;o||(o="immerser-section-".concat(r),t.id=o,t.__immerserCustomId=!0),e.stateIndexById[o]=r}))}},{key:"initStatemap",value:function(){var e=this;this.stateArray=this.layerNodeArray.map((function(t,r){var o=e.options.solidClassnameArray[r];return{beginEnter:0,beginLeave:0,endEnter:0,endLeave:0,id:t.id,layerBottom:0,layerTop:0,maskInnerNode:null,maskNode:null,layerNode:t,solidClassnames:o}}))}},{key:"validateClassnames",value:function(){this.stateArray.every((function(e){return!(t=e.solidClassnames)||0===Object.keys(t).length&&t.constructor===Object;var t}))&&h({message:"immerser will do nothing without solid classname configuration.",docs:"#prepare-your-markup"})}},{key:"toggleBindOnRezise",value:function(){var e=this;this.stopToggleBindOnRezise=this.reactiveWindowWidth.subscribe((function(t){t>=e.options.fromViewportWidth?e.isBound||e.bind():e.isBound&&e.unbind()}))}},{key:"setSizes",value:function(){var e=this;this.documentHeight=document.documentElement.offsetHeight,this.windowHeight=window.innerHeight,this.immerserTop=this.rootNode.offsetTop,this.immerserHeight=this.rootNode.offsetHeight,this.stateArray=this.stateArray.map((function(t){var r=t.layerNode.offsetTop,o=r+t.layerNode.offsetHeight,i=r-e.immerserTop,n=i-e.immerserHeight,s=o-e.immerserTop,a=s-e.immerserHeight;return v(v({},t),{},{layerTop:r,layerBottom:o,beginEnter:n,endEnter:i,beginLeave:a,endLeave:s})})),this.reactiveWindowWidth.value=window.innerWidth}},{key:"addScrollAndResizeListeners",value:function(){this.options.isScrollHandled&&(this.onScroll=this.handleScroll.bind(this),window.addEventListener("scroll",this.onScroll,!1)),this.onResize=this.handleResize.bind(this),window.addEventListener("resize",this.onResize,!1)}},{key:"bind",value:function(){this.createMarkup(),this.initPagerLinks(),this.initHoverSynchro(),this.attachCallbacks(),this.isBound=!0,this.draw(),"function"==typeof this.options.onBind&&this.options.onBind(this)}},{key:"unbind",value:function(){this.detachCallbacks(),this.removeSyncroHoverListeners(),this.clearCustomSectionIds(),this.restoreOriginalSolidNodes(),this.cleanupClonnedMarkup(),this.isBound=!1,"function"==typeof this.options.onUnbind&&this.options.onUnbind(this),this.reactiveActiveLayer.value=void 0}},{key:"resetInternalState",value:function(){this.stateArray=[],this.stateIndexById={},this.isBound=!1,this.rootNode=null,this.layerNodeArray=[],this.solidNodeArray=[],this.pagerLinkNodeArray=[],this.originalSolidNodeArray=[],this.maskNodeArray=[],this.synchroHoverNodeArray=[],this.isCustomMarkup=!1,this.customMaskNodeArray=[],this.documentHeight=0,this.windowHeight=0,this.immerserTop=0,this.immerserHeight=0,this.resizeFrameId=null,this.scrollFrameId=null,this.scrollAdjustTimerId=null,this.reactiveActiveLayer=new(s()),this.reactiveWindowWidth=new(s()),this.reactiveSynchroHoverId=new(s()),this.stopRedrawingPager=null,this.stopUpdatingHash=null,this.stopFiringActiveLayerChangeCallback=null,this.stopTrackingSynchroHover=null,this.stopToggleBindOnRezise=null,this.onResize=null,this.onScroll=null,this.onSynchroHoverMouseOver=null,this.onSynchroHoverMouseOut=null}},{key:"destroy",value:function(){var e;this.unbind(),null===(e=this.stopToggleBindOnRezise)||void 0===e||e.call(this),this.removeScrollAndResizeListeners(),"function"==typeof this.options.onDestroy&&this.options.onDestroy(this),this.resetInternalState()}},{key:"createMarkup",value:function(){var e=this;d(this.rootNode,k),this.initCustomMarkup(),this.originalSolidNodeArray=u({selector:this.selectors.solid,parent:this.rootNode}),this.stateArray=this.stateArray.map((function(t,r){var o=e.isCustomMarkup?e.customMaskNodeArray[r]:document.createElement("div");d(o,b);var i=e.isCustomMarkup?o.querySelector(e.selectors.maskInner):document.createElement("div");return d(i,b),e.isCustomMarkup||(o.dataset.immerserMask="",i.dataset.immerserMaskInner=""),e.originalSolidNodeArray.forEach((function(e){var t=e.cloneNode(!0);d(t,A),t.__immerserClonned=!0,i.appendChild(t)})),function(e,t){for(var r=0;r<e.length;r++)t(e[r],r,e)}(i.querySelectorAll(e.selectors.solid),(function(e){var r=e.dataset.immerserSolid;t.solidClassnames&&Object.prototype.hasOwnProperty.call(t.solidClassnames,r)&&e.classList.add(t.solidClassnames[r])})),0!==r&&o.setAttribute("aria-hidden","true"),o.appendChild(i),e.rootNode.appendChild(o),e.maskNodeArray.push(o),v(v({},t),{},{maskNode:o,maskInnerNode:i})})),this.detachOriginalSolidNodes()}},{key:"initCustomMarkup",value:function(){var e=this;this.customMaskNodeArray=u({selector:this.selectors.mask,parent:this.rootNode}),this.isCustomMarkup=this.customMaskNodeArray.length===this.stateArray.length,this.customMaskNodeArray.length>0&&!this.isCustomMarkup&&h({message:"You're trying use custom markup, but count of your immerser masks doesn't equal layers count.",warning:!0,docs:"#cloning-event-listeners"}),this.customMaskNodeArray.forEach((function(t){for(var r=t.querySelector(e.selectors.maskInner).children,o=0;o<r.length;o++)d(r[o],A)}))}},{key:"detachOriginalSolidNodes",value:function(){var e=this;this.originalSolidNodeArray.forEach((function(t){e.rootNode.removeChild(t)}))}},{key:"initPagerLinks",value:function(){var e=this;this.pagerLinkNodeArray=u({selector:this.selectors.pagerLink,parent:this.rootNode}),this.pagerLinkNodeArray.forEach((function(t){var r=t.href;if(r){var o=r.split("#")[1];if(o){var i=e.stateIndexById[o];t.dataset.immerserLayerIndex=i.toString()}}}))}},{key:"initHoverSynchro",value:function(){var e=this;this.synchroHoverNodeArray=u({selector:this.selectors.synchroHover,parent:this.rootNode}),this.onSynchroHoverMouseOver=function(t){var r=t.target.dataset.immerserSynchroHover;e.reactiveSynchroHoverId.value=r},this.onSynchroHoverMouseOut=function(){e.reactiveSynchroHoverId.value=void 0},this.synchroHoverNodeArray.forEach((function(t){t.addEventListener("mouseover",e.onSynchroHoverMouseOver),t.addEventListener("mouseout",e.onSynchroHoverMouseOut)}))}},{key:"attachCallbacks",value:function(){var e=this;this.pagerLinkNodeArray.length>0&&(this.stopRedrawingPager=this.reactiveActiveLayer.subscribe(this.drawPagerLinks.bind(this))),this.options.hasToUpdateHash&&(this.stopUpdatingHash=this.reactiveActiveLayer.subscribe(this.drawHash.bind(this))),"function"==typeof this.options.onActiveLayerChange&&(this.stopFiringActiveLayerChangeCallback=this.reactiveActiveLayer.subscribe((function(t){e.options.onActiveLayerChange(t,e)}))),this.synchroHoverNodeArray.length>0&&(this.stopTrackingSynchroHover=this.reactiveSynchroHoverId.subscribe(this.drawSynchroHover.bind(this)))}},{key:"detachCallbacks",value:function(){"function"==typeof this.stopRedrawingPager&&this.stopRedrawingPager(),"function"==typeof this.stopUpdatingHash&&this.stopUpdatingHash(),"function"==typeof this.stopFiringActiveLayerChangeCallback&&this.stopFiringActiveLayerChangeCallback(),"function"==typeof this.stopTrackingSynchroHover&&this.stopTrackingSynchroHover()}},{key:"removeSyncroHoverListeners",value:function(){var e=this;this.synchroHoverNodeArray.forEach((function(t){t.removeEventListener("mouseover",e.onSynchroHoverMouseOver),t.removeEventListener("mouseout",e.onSynchroHoverMouseOut)}))}},{key:"clearCustomSectionIds",value:function(){this.stateArray.forEach((function(e){e.layerNode.__immerserCustomId&&e.layerNode.removeAttribute("id")}))}},{key:"restoreOriginalSolidNodes",value:function(){var e=this;this.originalSolidNodeArray.forEach((function(t){e.rootNode.appendChild(t)}))}},{key:"cleanupClonnedMarkup",value:function(){var e=this;this.maskNodeArray.forEach((function(t){if(e.isCustomMarkup){t.removeAttribute("style"),t.removeAttribute("aria-hidden");var r=t.querySelector(e.selectors.maskInner);r.removeAttribute("style"),u({selector:e.selectors.solid,parent:r}).forEach((function(e){e.__immerserClonned&&r.removeChild(e)}))}else e.rootNode.removeChild(t)}))}},{key:"removeScrollAndResizeListeners",value:function(){this.options.isScrollHandled&&window.removeEventListener("scroll",this.onScroll,!1),window.removeEventListener("resize",this.onResize,!1)}},{key:"draw",value:function(e){var t=this,r=void 0!==e?e:p().y;this.stateArray.forEach((function(e,o){var i,n=e.beginEnter,s=e.endEnter,a=e.beginLeave,l=e.endLeave,c=e.maskNode,d=e.maskInnerNode,u=e.layerTop,h=e.layerBottom;i=n>r?t.immerserHeight:n<=r&&r<s?s-r:s<=r&&r<a?0:a<=r&&r<l?a-r:-t.immerserHeight,c.style.transform="translateY(".concat(i,"px)"),d.style.transform="translateY(".concat(-i,"px)");var f=r+t.windowHeight*(1-t.options.pagerThreshold);u<=f&&f<h&&(t.reactiveActiveLayer.value=o)}))}},{key:"drawPagerLinks",value:function(e){var t=this;this.pagerLinkNodeArray.forEach((function(r){parseInt(r.dataset.immerserLayerIndex,10)===e?r.classList.add(t.options.pagerLinkActiveClassname):r.classList.remove(t.options.pagerLinkActiveClassname)}))}},{key:"drawHash",value:function(e){var t=this.stateArray[e],r=t.id,o=t.layerNode;o.removeAttribute("id"),window.location.hash=r,o.setAttribute("id",r)}},{key:"drawSynchroHover",value:function(e){this.synchroHoverNodeArray.forEach((function(t){t.dataset.immerserSynchroHover===e?t.classList.add("_hover"):t.classList.remove("_hover")}))}},{key:"adjustScroll",value:function(){var e=this.stateArray[this.reactiveActiveLayer.value],t=e.layerTop,r=e.layerBottom,o=p(),i=o.x,n=o.y,s=Math.abs(n-t),a=Math.abs(n+this.windowHeight-r);0!==s&&0!==a&&(s<=a&&s<=this.options.scrollAdjustThreshold?window.scrollTo(i,t):a<=s&&a<=this.options.scrollAdjustThreshold&&window.scrollTo(i,r-this.windowHeight))}},{key:"onDOMChange",value:function(){this.setSizes(),this.draw()}},{key:"handleScroll",value:function(){var e=this;this.isBound&&(this.scrollFrameId&&(window.cancelAnimationFrame(this.scrollFrameId),this.scrollFrameId=null),this.scrollFrameId=window.requestAnimationFrame((function(){e.draw(),e.options.scrollAdjustThreshold>0&&(e.scrollAdjustTimerId&&(clearTimeout(e.scrollAdjustTimerId),e.scrollAdjustTimerId=null),e.scrollAdjustTimerId=setTimeout(e.adjustScroll.bind(e),e.options.scrollAdjustDelay))}),this.options.scrollAdjustDelay))}},{key:"handleResize",value:function(){var e=this;this.resizeFrameId&&(window.cancelAnimationFrame(this.resizeFrameId),this.resizeFrameId=null),this.resizeFrameId=window.requestAnimationFrame((function(){e.setSizes(),e.draw()}))}}])&&m(e.prototype,t),r&&m(e,r),Immerser}()}},t={};function r(o){if(t[o])return t[o].exports;var i=t[o]={exports:{}};return e[o](i,i.exports,r),i.exports}return r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(254)})().default}));
//# sourceMappingURL=immerser.min.js.map